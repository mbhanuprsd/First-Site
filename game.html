<html>
<h3>Ping Pong</h3>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
var canvas;
var canvasContext;

var ballX = 20;
var ballY = 20;
var ballSpeedX = 10;
var ballSpeedY = 4;

var leftPaddleY = 230;
var rightPaddleY = 230;

const PADDLE_WIDTH = 10;
const PADDLE_HEIGHT = 100;
const BALL_RADIUS = 10;

// DIfficulty easy(2) to hard (8)
const DIFFICULTY = 8

var player1Score = 0;
var player2Score = 0;

function calculateMousePos(evt) {
	var rect = canvas.getBoundingClientRect();
	var rootWindow = document.documentElement;
	var mouseX = evt.clientX - rect.left - rootWindow.scrollLeft;
	var mouseY = evt.clientY - rect.top - rootWindow.scrollTop;
	return {
		x:mouseX,
		y:mouseY
	}
}

function ballReset() {
	ballSpeedX = -ballSpeedX;
	ballX = canvas.width/2;
	ballY = canvas.height/2;
}

window.onload = function() {
	canvas = document.getElementById("gameCanvas");
	canvasContext = canvas.getContext("2d");

	var framesPerSecond = 30;
	setInterval(function(){
		moveEverything();
		drawEverything();
	}, 1000/framesPerSecond);

	canvas.addEventListener("mousemove", 
		function(evt) {
			var mousePos = calculateMousePos(evt);
			leftPaddleY = mousePos.y - PADDLE_HEIGHT/2;
		});
}

function computerMovement() {
	var rightPaddleCenter = rightPaddleY + (PADDLE_HEIGHT/2);
	if (rightPaddleCenter < ballY - PADDLE_HEIGHT/DIFFICULTY) {
		rightPaddleY += 6;
	} else if (rightPaddleCenter > ballY + PADDLE_HEIGHT/DIFFICULTY) {
		rightPaddleY -= 6;
	}
}

function moveEverything() {
	ballX += ballSpeedX;
	ballY += ballSpeedY;

	checkLeftBoundary();
	checkRightBoundary();
	setupTopBoundary();
	setupBottomBoundary();

	computerMovement();
}

function checkLeftBoundary() {
	// Left boundary
	if (ballX < BALL_RADIUS) {
		if (ballY > leftPaddleY &&
			ballY < leftPaddleY + PADDLE_HEIGHT) {
			ballSpeedX = -ballSpeedX;
		} else {
			ballReset();
			player2Score++;
		}
	}
}

function checkRightBoundary() {
	// Right boundary
	if (ballX > canvas.width - BALL_RADIUS) {
		if (ballY > rightPaddleY &&
			ballY < rightPaddleY + PADDLE_HEIGHT) {
			ballSpeedX = -ballSpeedX;
		} else {
			ballReset();
			player1Score++;
		}
	}
}

function setupTopBoundary() {
	// Top boundary
	if (ballY < BALL_RADIUS) {
		ballSpeedY = -ballSpeedY;
	}
}

function setupBottomBoundary() {
	// Bottom boundary
	if (ballY > canvas.height - BALL_RADIUS) {
		ballSpeedY = -ballSpeedY;
	}
}

function drawEverything() {
	// Draw black canvas
	colorRect(0, 0, canvas.width, canvas.height, "black");
	
	// Draw ball
	colorCircle(ballX, ballY, BALL_RADIUS, "white");

	// Draw left paddle
	colorRect(0, leftPaddleY, PADDLE_WIDTH, PADDLE_HEIGHT, "white");

	// Draw right paddle
	colorRect(canvas.width - PADDLE_WIDTH, rightPaddleY, PADDLE_WIDTH,
		PADDLE_HEIGHT, "white");

	drawScore();
}

function drawScore() {
	canvasContext.fillText(player1Score, canvas.width/4, canvas.height/4);
	canvasContext.fillText(player2Score, 3*canvas.width/4, canvas.height/4);
}

function colorRect(leftX, topY, width, height, drawColor) {
	canvasContext.fillStyle = drawColor;
	canvasContext.fillRect(leftX, topY, width, height);
}

function colorCircle(centerX, centerY, radius, drawColor) {
	canvasContext.fillStyle = drawColor;
	canvasContext.beginPath();
	canvasContext.arc(centerX, centerY, radius, 0, Math.PI*2, true);
	canvasContext.fill();
}

</script>

</html>
